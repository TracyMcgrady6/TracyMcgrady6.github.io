<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Second place means you&apos;re the first loser.">
<meta property="og:type" content="website">
<meta property="og:title" content="McGrady">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="McGrady">
<meta property="og:description" content="Second place means you&apos;re the first loser.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="McGrady">
<meta name="twitter:description" content="Second place means you&apos;re the first loser.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>McGrady</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">McGrady</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/26/TensorFlow分布式全套（原理，部署，实例）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="McGrady">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/haizei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="McGrady">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/26/TensorFlow分布式全套（原理，部署，实例）/" itemprop="url">TensorFlow分布式全套（原理，部署，实例）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-26T16:43:28+08:00">
                2017-07-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/深度学习/" itemprop="url" rel="index">
                    <span itemprop="name">深度学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="TensorFlow分布式全套（原理，部署，实例）"><a href="#TensorFlow分布式全套（原理，部署，实例）" class="headerlink" title="TensorFlow分布式全套（原理，部署，实例）"></a>TensorFlow分布式全套（原理，部署，实例）</h1><p>TF的实现分为了单机实现和分布式实现，在分布式实现中，需要实现的是对client，master，worker process不在同一台机器上时的支持。数据量很大的情况下，单机跑深度学习程序，过于耗时，所以需要TensorFlow分布式并行。<br>该例子是TF的入门实例手写字体识别MNIST基于分布式的实现，代码都加了中文注释，更加通俗易懂。</p>
<p><strong>GitHub实例地址：<a href="https://github.com/TracyMcgrady6/Distribute_MNIST" target="_blank" rel="external">https://github.com/TracyMcgrady6/Distribute_MNIST</a></strong><br>欢迎大家<strong>star</strong>！<br><img src="http://upload-images.jianshu.io/upload_images/2127249-ed0d5ef509964b45.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="单机与分布式TF结构"></p>
<h2 id="Single-Device-Execution"><a href="#Single-Device-Execution" class="headerlink" title="Single-Device Execution"></a>Single-Device Execution</h2><p>构建好图后，使用拓扑算法来决定执行哪一个节点，即对每个节点使用一个计数，值表示所依赖的未完成的节点数目，当一个节点的运算完成时，将依赖该节点的所有节点的计数减一。如果节点的计数为0，将其放入准备队列待执行。</p>
<h3 id="单机多GPU训练"><a href="#单机多GPU训练" class="headerlink" title="单机多GPU训练"></a>单机多GPU训练</h3><p>先简单介绍下单机的多GPU训练，然后再介绍分布式的多机多GPU训练。<br>单机的多GPU训练， tensorflow的官方已经给了一个cifar的例子，已经有比较详细的代码和文档介绍， 这里大致说下多GPU的过程，以便方便引入到多机多GPU的介绍。<br>单机多GPU的训练过程：</p>
<ol>
<li><p>假设你的机器上有3个GPU;</p>
</li>
<li><p>在单机单GPU的训练中，数据是一个batch一个batch的训练。 在单机多GPU中，数据一次处理3个batch(假设是3个GPU训练）， 每个GPU处理一个batch的数据计算。</p>
</li>
<li><p>变量，或者说参数，保存在CPU上</p>
</li>
<li><p>刚开始的时候数据由CPU分发给3个GPU， 在GPU上完成了计算，得到每个batch要更新的梯度。</p>
</li>
<li><p>然后在CPU上收集完了3个GPU上的要更新的梯度， 计算一下平均梯度，然后更新参数。</p>
</li>
<li><p>然后继续循环这个过程。</p>
</li>
</ol>
<p>通过这个过程，处理的速度取决于最慢的那个GPU的速度。如果3个GPU的处理速度差不多的话， 处理速度就相当于单机单GPU的速度的3倍减去数据在CPU和GPU之间传输的开销，实际的效率提升看CPU和GPU之间数据的速度和处理数据的大小。</p>
<h4 id="通俗解释"><a href="#通俗解释" class="headerlink" title="通俗解释"></a>通俗解释</h4><p>写到这里觉得自己写的还是不同通俗易懂， 下面就打一个更加通俗的比方来解释一下：</p>
<p>老师给小明和小华布置了10000张纸的乘法题并且把所有的乘法的结果加起来， 每张纸上有128道乘法题。 这里一张纸就是一个batch， batch_size就是128. 小明算加法比较快， 小华算乘法比较快，于是小华就负责计算乘法， 小明负责把小华的乘法结果加起来 。 这样小明就是CPU，小华就是GPU.</p>
<p>这样计算的话， 预计小明和小华两个人得要花费一个星期的时间才能完成老师布置的题目。 于是小明就招来2个算乘法也很快的小红和小亮。 于是每次小明就给小华，小红，小亮各分发一张纸，让他们算乘法， 他们三个人算完了之后， 把结果告诉小明， 小明把他们的结果加起来，然后再给他们没人分发一张算乘法的纸，依次循环，知道所有的算完。</p>
<p>这里小明采用的是同步模式，就是每次要等他们三个都算完了之后， 再统一算加法，算完了加法之后，再给他们三个分发纸张。这样速度就取决于他们三个中算乘法算的最慢的那个人， 和分发纸张的速度。</p>
<h2 id="Multi-Device-Execution"><a href="#Multi-Device-Execution" class="headerlink" title="Multi-Device Execution"></a>Multi-Device Execution</h2><p>当系统到了分布式情况下时，事情就变得复杂了很多，还好前述调度用了现有的框架。那么对于TF来说，剩下的事情就是：</p>
<p>决定运算在哪个设备上运行<br>管理设备之间的数据传递</p>
<h3 id="分布式多机多GPU训练"><a href="#分布式多机多GPU训练" class="headerlink" title="分布式多机多GPU训练"></a>分布式多机多GPU训练</h3><p>随着设计的模型越来越复杂，模型参数越来越多，越来越大， 大到什么程度？多到什么程度？ 多参数的个数上百亿个， 训练的数据多到按TB级别来衡量。大家知道每次计算一轮，都要计算梯度，更新参数。 当参数的量级上升到百亿量级甚至更大之后， 参数的更新的性能都是问题。 如果是单机16个GPU， 一个step最多也是处理16个batch， 这对于上TB级别的数据来说，不知道要训练到什么时候。于是就有了分布式的深度学习训练方法，或者说框架。</p>
<h3 id="参数服务器"><a href="#参数服务器" class="headerlink" title="参数服务器"></a>参数服务器</h3><p>在介绍tensorflow的分布式训练之前，先说下参数服务器的概念。<br>前面说道， 当你的模型越来越大， 模型的参数越来越多，多到模型参数的更新，一台机器的性能都不够的时候， 很自然的我们就会想到把参数分开放到不同的机器去存储和更新。<br>因为碰到上面提到的那些问题， 所有参数服务器就被单独拧出来， 于是就有了参数服务器的概念。 参数服务器可以是多台机器组成的集群， 这个就有点类似分布式的存储架构了， 涉及到数据的同步，一致性等等， 一般是key-value的形式，可以理解为一个分布式的key-value内存数据库，然后再加上一些参数更新的操作。 详细的细节可以去google一下， 这里就不详细说了。 反正就是当性能不够的时候，<br> 几百亿的参数分散到不同的机器上去保存和更新，解决参数存储和更新的性能问题。<br>借用上面的小明算题的例子，小明觉得自己算加法都算不过来了， 于是就叫了10个小明过来一起帮忙算。</p>
<h3 id="gRPC-google-remote-procedure-call"><a href="#gRPC-google-remote-procedure-call" class="headerlink" title="gRPC (google remote procedure call)"></a>gRPC (google remote procedure call)</h3><p>TensorFlow分布式并行基于gRPC通信框架，其中包括一个master创建Session，还有多个worker负责执行计算图中的任务。</p>
<p>gRPC首先是一个RPC，即远程过程调用,通俗的解释是：假设你在本机上执行一段代码<code>num=add(a,b)</code>，它调用了一个过程 call，然后返回了一个值num，你感觉这段代码只是在本机上执行的, 但实际情况是,本机上的add方法是将参数打包发送给服务器,然后服务器运行服务器端的add方法,返回的结果再将数据打包返回给客户端.</p>
<h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><p>Cluster是Job的集合，Job是Task的集合。</p>
<blockquote>
<p>即：一个Cluster可以切分多个Job，一个Job指一类特定的任务，每个Job包含多个Task，比如parameter server(ps)、worker，在大多数情况下,一个机器上只运行一个Task.</p>
</blockquote>
<p>在分布式深度学习框架中,我们一般把Job划分为Parameter Server和Worker:</p>
<ul>
<li>Parameter Job是管理参数的存储和更新工作.</li>
<li>Worker Job是来运行ops.</li>
</ul>
<p>如果参数的数量太大,一台机器处理不了,这就要需要多个Tasks.</p>
<h3 id="TF分布式模式"><a href="#TF分布式模式" class="headerlink" title="TF分布式模式"></a>TF分布式模式</h3><h4 id="In-graph-模式"><a href="#In-graph-模式" class="headerlink" title="In-graph 模式"></a>In-graph 模式</h4><blockquote>
<p>将模型的计算图的不同部分放在不同的机器上执行</p>
</blockquote>
<p>In-graph模式和单机多GPU模型有点类似。 还是一个小明算加法， 但是算乘法的就可以不止是他们一个教室的小华，小红，小亮了。 可以是其他教师的小张，小李。。。。</p>
<p>In-graph模式， 把计算已经从单机多GPU，已经扩展到了多机多GPU了， 不过数据分发还是在一个节点。 这样的好处是配置简单， 其他多机多GPU的计算节点，只要起个join操作， 暴露一个网络接口，等在那里接受任务就好了。 这些计算节点暴露出来的网络接口，使用起来就跟本机的一个GPU的使用一样， 只要在操作的时候指定tf.device(“/job:worker/task:n”)，<br> 就可以向指定GPU一样，把操作指定到一个计算节点上计算，使用起来和多GPU的类似。 但是这样的坏处是训练数据的分发依然在一个节点上， 要把训练数据分发到不同的机器上， 严重影响并发训练速度。在大数据训练的情况下， 不推荐使用这种模式。</p>
<h4 id="Between-graph-模式"><a href="#Between-graph-模式" class="headerlink" title="Between-graph 模式"></a>Between-graph 模式</h4><blockquote>
<p>数据并行，每台机器使用完全相同的计算图</p>
</blockquote>
<p>Between-graph模式下，训练的参数保存在参数服务器， 数据不用分发， 数据分片的保存在各个计算节点， 各个计算节点自己算自己的， 算完了之后， 把要更新的参数告诉参数服务器，参数服务器更新参数。这种模式的优点是不用训练数据的分发了， 尤其是在数据量在TB级的时候， 节省了大量的时间，所以大数据深度学习还是推荐使用Between-graph模式。</p>
<h3 id="同步更新和异步更新"><a href="#同步更新和异步更新" class="headerlink" title="同步更新和异步更新"></a>同步更新和异步更新</h3><blockquote>
<p>in-graph模式和between-graph模式都支持同步和异步更新。</p>
</blockquote>
<p>在同步更新的时候， 每次梯度更新，要等所有分发出去的数据计算完成后，返回回来结果之后，把梯度累加算了均值之后，再更新参数。 这样的好处是loss的下降比较稳定， 但是这个的坏处也很明显， 处理的速度取决于最慢的那个分片计算的时间。</p>
<p>在异步更新的时候， 所有的计算节点，各自算自己的， 更新参数也是自己更新自己计算的结果， 这样的优点就是计算速度快， 计算资源能得到充分利用，但是缺点是loss的下降不稳定， 抖动大。</p>
<p>在数据量小的情况下， 各个节点的计算能力比较均衡的情况下， 推荐使用同步模式；数据量很大，各个机器的计算性能掺差不齐的情况下，推荐使用异步的方式。</p>
<p>##实例</p>
<blockquote>
<p>tensorflow官方有个分布式tensorflow的文档，但是例子没有完整的代码， 这里写了一个最简单的可以跑起来的例子，供大家参考，这里也傻瓜式给大家解释一下代码，以便更加通俗的理解。</p>
</blockquote>
<p>该例子是TF的入门实例手写字体识别MNIST基于分布式的实现，代码都加了中文注释，更加通俗易懂。</p>
<h3 id="执行命令示例"><a href="#执行命令示例" class="headerlink" title="执行命令示例"></a>执行命令示例</h3><p>ps 节点执行： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python distributed.py --job_name=ps --task_index=0</div></pre></td></tr></table></figure>
<p>worker1 节点执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python distributed.py --job_name=worker --task_index=0</div></pre></td></tr></table></figure>
<p>worker2 节点执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python distributed.py --job_name=worker --task_index=1</div></pre></td></tr></table></figure>
<h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><h4 id="worker0节点运行结果"><a href="#worker0节点运行结果" class="headerlink" title="worker0节点运行结果"></a>worker0节点运行结果</h4><p><img src="http://upload-images.jianshu.io/upload_images/2127249-83b279790e55553d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h4 id="worker1节点运行结果"><a href="#worker1节点运行结果" class="headerlink" title="worker1节点运行结果"></a>worker1节点运行结果</h4><p><img src="http://upload-images.jianshu.io/upload_images/2127249-fd7eb95edb14435d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="实验代码"><a href="#实验代码" class="headerlink" title="实验代码"></a>实验代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># encoding:utf-8</span></div><div class="line"><span class="keyword">import</span> math</div><div class="line"><span class="keyword">import</span> tempfile</div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line"><span class="keyword">from</span> tensorflow.examples.tutorials.mnist <span class="keyword">import</span> input_data</div><div class="line"></div><div class="line">flags = tf.app.flags</div><div class="line">IMAGE_PIXELS = <span class="number">28</span></div><div class="line"><span class="comment"># 定义默认训练参数和数据路径</span></div><div class="line">flags.DEFINE_string(<span class="string">'data_dir'</span>, <span class="string">'/tmp/mnist-data'</span>, <span class="string">'Directory  for storing mnist data'</span>)</div><div class="line">flags.DEFINE_integer(<span class="string">'hidden_units'</span>, <span class="number">100</span>, <span class="string">'Number of units in the hidden layer of the NN'</span>)</div><div class="line">flags.DEFINE_integer(<span class="string">'train_steps'</span>, <span class="number">10000</span>, <span class="string">'Number of training steps to perform'</span>)</div><div class="line">flags.DEFINE_integer(<span class="string">'batch_size'</span>, <span class="number">100</span>, <span class="string">'Training batch size '</span>)</div><div class="line">flags.DEFINE_float(<span class="string">'learning_rate'</span>, <span class="number">0.01</span>, <span class="string">'Learning rate'</span>)</div><div class="line"><span class="comment"># 定义分布式参数</span></div><div class="line"><span class="comment"># 参数服务器parameter server节点</span></div><div class="line">flags.DEFINE_string(<span class="string">'ps_hosts'</span>, <span class="string">'192.168.32.145:22221'</span>, <span class="string">'Comma-separated list of hostname:port pairs'</span>)</div><div class="line"><span class="comment"># 两个worker节点</span></div><div class="line">flags.DEFINE_string(<span class="string">'worker_hosts'</span>, <span class="string">'192.168.32.146:22221,192.168.32.160:22221'</span>,</div><div class="line">                    <span class="string">'Comma-separated list of hostname:port pairs'</span>)</div><div class="line"><span class="comment"># 设置job name参数</span></div><div class="line">flags.DEFINE_string(<span class="string">'job_name'</span>, <span class="keyword">None</span>, <span class="string">'job name: worker or ps'</span>)</div><div class="line"><span class="comment"># 设置任务的索引</span></div><div class="line">flags.DEFINE_integer(<span class="string">'task_index'</span>, <span class="keyword">None</span>, <span class="string">'Index of task within the job'</span>)</div><div class="line"><span class="comment"># 选择异步并行，同步并行</span></div><div class="line">flags.DEFINE_integer(<span class="string">"issync"</span>, <span class="keyword">None</span>, <span class="string">"是否采用分布式的同步模式，1表示同步模式，0表示异步模式"</span>)</div><div class="line"></div><div class="line">FLAGS = flags.FLAGS</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(unused_argv)</span>:</span></div><div class="line">    mnist = input_data.read_data_sets(FLAGS.data_dir, one_hot=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> FLAGS.job_name <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> FLAGS.job_name == <span class="string">''</span>:</div><div class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'Must specify an explicit job_name !'</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'job_name : %s'</span> % FLAGS.job_name</div><div class="line">    <span class="keyword">if</span> FLAGS.task_index <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> FLAGS.task_index == <span class="string">''</span>:</div><div class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'Must specify an explicit task_index!'</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'task_index : %d'</span> % FLAGS.task_index</div><div class="line"></div><div class="line">    ps_spec = FLAGS.ps_hosts.split(<span class="string">','</span>)</div><div class="line">    worker_spec = FLAGS.worker_hosts.split(<span class="string">','</span>)</div><div class="line"></div><div class="line">    <span class="comment"># 创建集群</span></div><div class="line">    num_worker = len(worker_spec)</div><div class="line">    cluster = tf.train.ClusterSpec(&#123;<span class="string">'ps'</span>: ps_spec, <span class="string">'worker'</span>: worker_spec&#125;)</div><div class="line">    server = tf.train.Server(cluster, job_name=FLAGS.job_name, task_index=FLAGS.task_index)</div><div class="line">    <span class="keyword">if</span> FLAGS.job_name == <span class="string">'ps'</span>:</div><div class="line">        server.join()</div><div class="line"></div><div class="line">    is_chief = (FLAGS.task_index == <span class="number">0</span>)</div><div class="line">    <span class="comment"># worker_device = '/job:worker/task%d/cpu:0' % FLAGS.task_index</span></div><div class="line">    <span class="keyword">with</span> tf.device(tf.train.replica_device_setter(</div><div class="line">            cluster=cluster</div><div class="line">    )):</div><div class="line">        global_step = tf.Variable(<span class="number">0</span>, name=<span class="string">'global_step'</span>, trainable=<span class="keyword">False</span>)  <span class="comment"># 创建纪录全局训练步数变量</span></div><div class="line"></div><div class="line">        hid_w = tf.Variable(tf.truncated_normal([IMAGE_PIXELS * IMAGE_PIXELS, FLAGS.hidden_units],</div><div class="line">                                                stddev=<span class="number">1.0</span> / IMAGE_PIXELS), name=<span class="string">'hid_w'</span>)</div><div class="line">        hid_b = tf.Variable(tf.zeros([FLAGS.hidden_units]), name=<span class="string">'hid_b'</span>)</div><div class="line"></div><div class="line">        sm_w = tf.Variable(tf.truncated_normal([FLAGS.hidden_units, <span class="number">10</span>],</div><div class="line">                                               stddev=<span class="number">1.0</span> / math.sqrt(FLAGS.hidden_units)), name=<span class="string">'sm_w'</span>)</div><div class="line">        sm_b = tf.Variable(tf.zeros([<span class="number">10</span>]), name=<span class="string">'sm_b'</span>)</div><div class="line"></div><div class="line">        x = tf.placeholder(tf.float32, [<span class="keyword">None</span>, IMAGE_PIXELS * IMAGE_PIXELS])</div><div class="line">        y_ = tf.placeholder(tf.float32, [<span class="keyword">None</span>, <span class="number">10</span>])</div><div class="line"></div><div class="line">        hid_lin = tf.nn.xw_plus_b(x, hid_w, hid_b)</div><div class="line">        hid = tf.nn.relu(hid_lin)</div><div class="line"></div><div class="line">        y = tf.nn.softmax(tf.nn.xw_plus_b(hid, sm_w, sm_b))</div><div class="line">        cross_entropy = -tf.reduce_sum(y_ * tf.log(tf.clip_by_value(y, <span class="number">1e-10</span>, <span class="number">1.0</span>)))</div><div class="line"></div><div class="line">        opt = tf.train.AdamOptimizer(FLAGS.learning_rate)</div><div class="line"></div><div class="line">        train_step = opt.minimize(cross_entropy, global_step=global_step)</div><div class="line">        <span class="comment"># 生成本地的参数初始化操作init_op</span></div><div class="line">        init_op = tf.global_variables_initializer()</div><div class="line">        train_dir = tempfile.mkdtemp()</div><div class="line">        sv = tf.train.Supervisor(is_chief=is_chief, logdir=train_dir, init_op=init_op, recovery_wait_secs=<span class="number">1</span>,</div><div class="line">                                 global_step=global_step)</div><div class="line"></div><div class="line">        <span class="keyword">if</span> is_chief:</div><div class="line">            <span class="keyword">print</span> <span class="string">'Worker %d: Initailizing session...'</span> % FLAGS.task_index</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">print</span> <span class="string">'Worker %d: Waiting for session to be initaialized...'</span> % FLAGS.task_index</div><div class="line">        sess = sv.prepare_or_wait_for_session(server.target)</div><div class="line">        <span class="keyword">print</span> <span class="string">'Worker %d: Session initialization  complete.'</span> % FLAGS.task_index</div><div class="line"></div><div class="line">        time_begin = time.time()</div><div class="line">        <span class="keyword">print</span> <span class="string">'Traing begins @ %f'</span> % time_begin</div><div class="line"></div><div class="line">        local_step = <span class="number">0</span></div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            batch_xs, batch_ys = mnist.train.next_batch(FLAGS.batch_size)</div><div class="line">            train_feed = &#123;x: batch_xs, y_: batch_ys&#125;</div><div class="line"></div><div class="line">            _, step = sess.run([train_step, global_step], feed_dict=train_feed)</div><div class="line">            local_step += <span class="number">1</span></div><div class="line"></div><div class="line">            now = time.time()</div><div class="line">            <span class="keyword">print</span> <span class="string">'%f: Worker %d: traing step %d dome (global step:%d)'</span> % (now, FLAGS.task_index, local_step, step)</div><div class="line"></div><div class="line">            <span class="keyword">if</span> step &gt;= FLAGS.train_steps:</div><div class="line">                <span class="keyword">break</span></div><div class="line"></div><div class="line">        time_end = time.time()</div><div class="line">        <span class="keyword">print</span> <span class="string">'Training ends @ %f'</span> % time_end</div><div class="line">        train_time = time_end - time_begin</div><div class="line">        <span class="keyword">print</span> <span class="string">'Training elapsed time:%f s'</span> % train_time</div><div class="line"></div><div class="line">        val_feed = &#123;x: mnist.validation.images, y_: mnist.validation.labels&#125;</div><div class="line">        val_xent = sess.run(cross_entropy, feed_dict=val_feed)</div><div class="line">        <span class="keyword">print</span> <span class="string">'After %d training step(s), validation cross entropy = %g'</span> % (FLAGS.train_steps, val_xent)</div><div class="line">    sess.close()</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    tf.app.run()</div></pre></td></tr></table></figure>
<p>参考：<br><a href="http://blog.csdn.net/luodongri/article/details/52596780" target="_blank" rel="external">http://blog.csdn.net/luodongri/article/details/52596780</a><br><a href="http://blog.csdn.net/u012436149/article/details/53140869" target="_blank" rel="external">http://blog.csdn.net/u012436149/article/details/53140869</a><br><a href="http://blog.csdn.net/stdcoutzyx/article/details/51645396" target="_blank" rel="external">http://blog.csdn.net/stdcoutzyx/article/details/51645396</a><br>TensorFlow实战[黄文坚 唐源 著]</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/12/从零开始掌握Python机器学习（附资源）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="McGrady">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/haizei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="McGrady">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/12/从零开始掌握Python机器学习（附资源）/" itemprop="url">从零开始掌握Python机器学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-12T12:50:40+08:00">
                2017-04-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/机器学习/" itemprop="url" rel="index">
                    <span itemprop="name">机器学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="从零开始掌握Python机器学习（附资源）"><a href="#从零开始掌握Python机器学习（附资源）" class="headerlink" title="从零开始掌握Python机器学习（附资源）"></a>从零开始掌握Python机器学习（附资源）</h1><h2 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h2><h3 id="第一步：基本-Python-技能"><a href="#第一步：基本-Python-技能" class="headerlink" title="第一步：基本 Python 技能"></a>第一步：基本 Python 技能</h3><p>如果我们打算利用 Python 来执行机器学习，那么对 Python 有一些基本的了解就是至关重要的。幸运的是，因为 Python 是一种得到了广泛使用的通用编程语言，加上其在科学计算和机器学习领域的应用，所以找到一个初学者教程并不十分困难。你在 Python 和编程上的经验水平对于起步而言是至关重要的。</p>
<p>首先，你需要安装 Python。因为我们后面会用到科学计算和机器学习软件包，所以我建议你安装 Anaconda。这是一个可用于 Linux、OS X 和 Windows 上的工业级的 Python 实现，完整包含了机器学习所需的软件包，包括 numpy、scikit-learn 和 matplotlib。其也包含了 iPython Notebook，这是一个用在我们许多教程中的交互式环境。我推荐安装 Python 2.7。<br>如果你不懂编程，我建议你从下面的免费在线书籍开始学习，然后再进入后续的材料：</p>
<ul>
<li><p>Learn Python the Hard Way，<br>作者 Zed A. Shaw：<a href="https://learnpythonthehardway.org/book/" target="_blank" rel="external">https://learnpythonthehardway.org/book/</a><br>如果你有编程经验，但不懂 Python 或还很初级，我建议你学习下面两个课程：</p>
</li>
<li><p>谷歌开发者 Python 课程（强烈推荐视觉学习者学习）<a href="http://suo.im/toMzq" target="_blank" rel="external">http://suo.im/toMzq</a> </p>
</li>
<li>Python 科学计算入门（来自 UCSB Engineering 的 M. Scott Shell）（一个不错的入门，大约有 60 页）：    <a href="http://suo.im/2cXycM" target="_blank" rel="external">http://suo.im/2cXycM</a> </li>
</ul>
<p>如果你要 30 分钟上手 Python 的快速课程，看下面：</p>
<ul>
<li>在 Y 分钟内学会 X（X=Python）：   <a href="http://suo.im/zm6qX" target="_blank" rel="external">http://suo.im/zm6qX</a> </li>
</ul>
<p>当然，如果你已经是一位经验丰富的 Python 程序员，即便如此，我也建议你常使用 Python 文档了，这一步就可以跳过    <a href="https://www.python.org/doc/" target="_blank" rel="external">https://www.python.org/doc/</a> </p>
<h3 id="第二步：机器学习基础技巧"><a href="#第二步：机器学习基础技巧" class="headerlink" title="第二步：机器学习基础技巧"></a>第二步：机器学习基础技巧</h3><p>KDnuggets 的 Zachary Lipton 已经指出：现在，人们评价一个「数据科学家」已经有很多不同标准了。这实际上是机器学习领域领域的一个写照，因为数据科学家大部分时间干的事情都牵涉到不同程度地使用机器学习算法。为了有效地创造和获得来自支持向量机的洞见，非常熟悉核方法（kernel methods）是否必要呢？当然不是。就像几乎生活中的所有事情一样，掌握理论的深度是与实践应用相关的。对机器学习算法的深度了解超过了本文探讨的范围，它通常需要你将非常大量的时间投入到更加学术的课程中去，或者至少是你自己要进行高强度的自学训练。</p>
<p>好消息是，对实践来说，你并不需要获得机器学习博士般的理论理解——就想要成为一个高效的程序员并不必要进行计算机科学理论的学习。</p>
<p>人们对吴恩达在 Coursera 上的机器学习课程内容往往好评如潮；然而，我的建议是浏览前一个学生在线记录的课堂笔记。跳过特定于 Octave（一个类似于 Matlab 的与你 Python 学习无关的语言）的笔记。一定要明白这些都不是官方笔记，但是可以从它们中把握到吴恩达课程材料中相关的内容。当然如果你有时间和兴趣，你现在就可以去 Coursera 上学习吴恩达的机器学习课程：<a href="http://suo.im/2o1uD" target="_blank" rel="external">http://suo.im/2o1uD</a> </p>
<ul>
<li>吴恩达课程的非官方笔记：    <a href="http://www.holehouse.org/mlclass/" target="_blank" rel="external">http://www.holehouse.org/mlclass/</a> </li>
</ul>
<p>除了上面提到的吴恩达课程，如果你还需要需要其它的，网上还有很多各类课程供你选择。比如我就很喜欢 Tom Mitchell，这里是他最近演讲的视频（一起的还有 Maria-Florina Balcan），非常平易近人。</p>
<ul>
<li>Tom Mitchell 的机器学习课程：   <a href="http://suo.im/497arw" target="_blank" rel="external">http://suo.im/497arw</a> </li>
</ul>
<p>目前你不需要所有的笔记和视频。一个有效地方法是当你觉得合适时，直接去看下面特定的练习题，参考上述备注和视频恰当的部分。</p>
<h3 id="第三步：科学计算-Python-软件包概述"><a href="#第三步：科学计算-Python-软件包概述" class="headerlink" title="第三步：科学计算 Python 软件包概述"></a>第三步：科学计算 Python 软件包概述</h3><p>好了，我们已经掌握了 Python 编程并对机器学习有了一定的了解。而在 Python 之外，还有一些常用于执行实际机器学习的开源软件库。广义上讲，有很多所谓的科学 Python 库（scientific Python libraries）可用于执行基本的机器学习任务（这方面的判断肯定有些主观性）：</p>
<ul>
<li>numpy——主要对其 N 维数组对象有用<br><a href="http://www.numpy.org/" target="_blank" rel="external">http://www.numpy.org/</a> </li>
<li>pandas——Python 数据分析库，包括数据框架（dataframes）等结构<a href="http://pandas.pydata.org/" target="_blank" rel="external">http://pandas.pydata.org/</a> </li>
<li>matplotlib——一个 2D 绘图库，可产生出版物质量的图表<br><a href="http://matplotlib.org/" target="_blank" rel="external">http://matplotlib.org/</a> </li>
<li>scikit-learn——用于数据分析和数据挖掘人物的机器学习算法<br><a href="http://scikit-learn.org/stable/" target="_blank" rel="external">http://scikit-learn.org/stable/</a> </li>
</ul>
<p>学习这些库的一个好方法是学习下面的材料：</p>
<ul>
<li>Scipy Lecture Notes，来自 Gaël Varoquaux、Emmanuelle Gouillart 和 Olav Vahtras：<a href="http://www.scipy-lectures.org/" target="_blank" rel="external">http://www.scipy-lectures.org/</a> </li>
<li>这个 pandas 教程也很不错：10 Minutes to Pandas：<a href="http://suo.im/4an6gY" target="_blank" rel="external">http://suo.im/4an6gY</a> </li>
</ul>
<h3 id="第四步：使用-Python-学习机器学习"><a href="#第四步：使用-Python-学习机器学习" class="headerlink" title="第四步：使用 Python 学习机器学习"></a>第四步：使用 Python 学习机器学习</h3><p>首先检查一下准备情况</p>
<ul>
<li>Python：就绪</li>
<li>机器学习基本材料：就绪</li>
<li>Numpy：就绪</li>
<li>Pandas：就绪</li>
<li>Matplotlib：就绪</li>
</ul>
<p>现在是时候使用 Python 机器学习标准库 scikit-learn 来实现机器学习算法了。</p>
<p>下面许多的教程和训练都是使用 iPython (Jupyter) Notebook 完成的，iPython Notebook 是执行 Python 语句的交互式环境。iPython Notebook 可以很方便地在网上找到或下载到你的本地计算机。</p>
<ul>
<li>来自斯坦福的 iPython Notebook 概览： <a href="http://cs231n.github.io/ipython-tutorial/" target="_blank" rel="external">http://cs231n.github.io/ipython-tutorial/</a> </li>
</ul>
<p>同样也请注意，以下的教程是由一系列在线资源所组成。如果你感觉课程有什么不合适的，可以和作者交流。我们第一个教程就是从 scikit-learn 开始的，我建议你们在继续完成教程前可以按顺序看一看以下的文章。</p>
<p>下面是一篇是对 scikit-learn 简介的文章，scikit-learn 是 Python 最常用的通用机器学习库，其覆盖了 K 近邻算法：</p>
<ul>
<li>Jake VanderPlas 写的 scikit-learn 简介：   <a href="http://suo.im/3bMdEd" target="_blank" rel="external">http://suo.im/3bMdEd</a>    </li>
</ul>
<p>下面的会更加深入、扩展的一篇简介，包括了从著名的数据库开始完成一个项目：</p>
<ul>
<li>Randal Olson 的机器学习案例笔记：   <a href="http://suo.im/RcPR6" target="_blank" rel="external">http://suo.im/RcPR6</a> </li>
</ul>
<p>下一篇关注于在 scikit-learn 上评估不同模型的策略，包括训练集/测试集的分割方法：</p>
<ul>
<li>Kevin Markham 的模型评估：   <a href="http://suo.im/2HIXDD" target="_blank" rel="external">http://suo.im/2HIXDD</a> </li>
</ul>
<p>第五步：Python 上实现机器学习的基本算法</p>
<p>在有了 scikit-learn 的基本知识后，我们可以进一步探索那些更加通用和实用的算法。我们从非常出名的 K 均值聚类（k-means clustering）算法开始，它是一种非常简单和高效的方法，能很好地解决非监督学习问题：</p>
<ul>
<li>K-均值聚类：<a href="http://suo.im/40R8zf" target="_blank" rel="external">http://suo.im/40R8zf</a>   </li>
</ul>
<p>接下来我们可以回到分类问题，并学习曾经最流行的分类算法：</p>
<ul>
<li>决策树： <a href="http://thegrimmscientist.com/tutorial-decision-trees/" target="_blank" rel="external">http://thegrimmscientist.com/tutorial-decision-trees/</a> </li>
</ul>
<p>在了解分类问题后，我们可以继续看看连续型数值预测：</p>
<ul>
<li>线性回归：<a href="http://suo.im/3EV4Qn" target="_blank" rel="external">http://suo.im/3EV4Qn</a> </li>
</ul>
<p>我们也可以利用回归的思想应用到分类问题中，即 logistic 回归：</p>
<ul>
<li>logistic 回归：<a href="http://suo.im/S2beL" target="_blank" rel="external">http://suo.im/S2beL</a> </li>
</ul>
<h3 id="第六步：Python-上实现进阶机器学习算法"><a href="#第六步：Python-上实现进阶机器学习算法" class="headerlink" title="第六步：Python 上实现进阶机器学习算法"></a>第六步：Python 上实现进阶机器学习算法</h3><p>我们已经熟悉了 scikit-learn，现在我们可以了解一下更高级的算法了。首先就是支持向量机，它是一种依赖于将数据转换映射到高维空间的非线性分类器。</p>
<ul>
<li>支持向量机：<a href="http://suo.im/2iZLLa" target="_blank" rel="external">http://suo.im/2iZLLa</a> </li>
</ul>
<p>随后，我们可以通过 Kaggle Titanic 竞赛检查学习作为集成分类器的随机森林：</p>
<ul>
<li>Kaggle Titanic 竞赛（使用随机森林）：   <a href="http://suo.im/1o7ofe" target="_blank" rel="external">http://suo.im/1o7ofe</a> </li>
</ul>
<p>降维算法经常用于减少在问题中所使用的变量。主成份分析法就是非监督降维算法的一个特殊形式：</p>
<ul>
<li>降维算法：<a href="http://suo.im/2k5y2E" target="_blank" rel="external">http://suo.im/2k5y2E</a> </li>
</ul>
<p>在进入第七步之前，我们可以花一点时间考虑在相对较短的时间内取得的一些进展。</p>
<p>首先使用 Python 及其机器学习库，我们不仅已经了解了一些最常见和知名的机器学习算法（k 近邻、k 均值聚类、支持向量机等），还研究了强大的集成技术（随机森林）和一些额外的机器学习任务（降维算法和模型验证技术）。除了一些基本的机器学习技巧，我们已经开始寻找一些有用的工具包。</p>
<p>我们会进一步学习新的必要工具。</p>
<p>第七步：Python 深度学习</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2127249-c393479a360fed77.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>深度学习无处不在。深度学习建立在几十年前的神经网络的基础上，但是最近的进步始于几年前，并极大地提高了深度神经网络的认知能力，引起了人们的广泛兴趣。如果你对神经网络还不熟悉，KDnuggets 有很多文章详细介绍了最近深度学习大量的创新、成就和赞许。</p>
<p>最后一步并不打算把所有类型的深度学习评论一遍，而是在 2 个先进的当代 Python 深度学习库中探究几个简单的网络实现。对于有兴趣深挖深度学习的读者，我建议从下面这些免费的在线书籍开始：</p>
<ul>
<li>神经网络与深度学习，作者 Michael Nielsen：<br><a href="http://neuralnetworksanddeeplearning.com/" target="_blank" rel="external">http://neuralnetworksanddeeplearning.com/</a> </li>
</ul>
<p>1.Theano</p>
<p>链接：  <a href="http://deeplearning.net/software/theano/" target="_blank" rel="external">http://deeplearning.net/software/theano/</a> </p>
<p>Theano 是我们讲到的第一个 Python 深度学习库。看看 Theano 作者怎么说：</p>
<blockquote>
<p>Theano 是一个 Python 库，它可以使你有效地定义、优化和评估包含多维数组的数学表达式。</p>
</blockquote>
<p>下面关于运用 Theano 学习深度学习的入门教程有点长，但是足够好，描述生动，评价很高：</p>
<p>Theano 深度学习教程，作者 Colin Raffel：  <a href="http://suo.im/1mPGHe" target="_blank" rel="external">http://suo.im/1mPGHe</a> </p>
<p>2.Caffe </p>
<p>链接：<a href="http://caffe.berkeleyvision.org/" target="_blank" rel="external">http://caffe.berkeleyvision.org/</a> </p>
<p>另一个我们将测试驱动的库是 Caffe。再一次，让我们从作者开始：</p>
<blockquote>
<p>Caffe 是一个深度学习框架，由表达、速度和模块性建构，Bwekeley 视觉与学习中心和社区工作者共同开发了 Caf fe。</p>
</blockquote>
<p>这个教程是本篇文章中最好的一个。我们已经学习了上面几个有趣的样例，但没有一个可与下面这个样例相竞争，其可通过 Caffe 实现谷歌的 DeepDream。这个相当精彩！掌握教程之后，可以尝试使你的处理器自如运行，就当作是娱乐。</p>
<ul>
<li>通过 Caffe 实现谷歌 DeepDream：   <a href="http://suo.im/2cUSXS" target="_blank" rel="external">http://suo.im/2cUSXS</a> </li>
</ul>
<p>我并没有保证说这会很快或容易，但是如果你投入了时间并完成了上面的 7 个步骤，你将在理解大量机器学习算法以及通过流行的库（包括一些在目前深度学习研究领域最前沿的库）在 Python 中实现算法方面变得很擅长。</p>
<h2 id="进阶篇"><a href="#进阶篇" class="headerlink" title="进阶篇"></a>进阶篇</h2><p><img src="http://upload-images.jianshu.io/upload_images/2127249-4bad6c4cca584a19.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>本篇是使用 Python 掌握机器学习的 7 个步骤系列文章的下篇，如果你已经学习了该系列的上篇，那么应该达到了令人满意的学习速度和熟练技能；如果没有的话，你也许应该回顾一下上篇，具体花费多少时间，取决于你当前的理解水平。我保证这样做是值得的。快速回顾之后，本篇文章会更明确地集中于几个机器学习相关的任务集上。由于安全地跳过了一些基础模块——Python 基础、机器学习基础等等——我们可以直接进入到不同的机器学习算法之中。这次我们可以根据功能更好地分类教程。</p>
<h3 id="第1步：机器学习基础回顾-amp-一个新视角"><a href="#第1步：机器学习基础回顾-amp-一个新视角" class="headerlink" title="第1步：机器学习基础回顾&amp;一个新视角"></a>第1步：机器学习基础回顾&amp;一个新视角</h3><p>上篇中包括以下几步：</p>
<ol>
<li>Python 基础技能</li>
<li>机器学习基础技能</li>
<li>Python 包概述</li>
<li>运用 Python 开始机器学习：介绍&amp;模型评估</li>
<li>关于 Python 的机器学习主题：k-均值聚类、决策树、线性回归&amp;逻辑回归</li>
<li>关于 Python 的高阶机器学习主题：支持向量机、随机森林、PCA 降维</li>
<li>Python 中的深度学习</li>
</ol>
<p>如上所述，如果你正准备从头开始，我建议你按顺序读完上篇。我也会列出所有适合新手的入门材料，安装说明包含在上篇文章中。</p>
<p>然而，如果你已经读过，我会从下面最基础的开始：</p>
<ul>
<li>机器学习关键术语解释，作者 Matthew Mayo。地址： <a href="http://suo.im/2URQGm" target="_blank" rel="external">http://suo.im/2URQGm</a> </li>
<li>维基百科条目：统计学分类。地址：  <a href="http://suo.im/mquen" target="_blank" rel="external">http://suo.im/mquen</a> </li>
<li>机器学习：一个完整而详细的概述，作者 Alex Castrounis。地址： <a href="http://suo.im/1yjSSq" target="_blank" rel="external">http://suo.im/1yjSSq</a> </li>
</ul>
<p>如果你正在寻找学习机器学习基础的替代或补充性方法，恰好我可以把正在看的 Shai Ben-David 的视频讲座和 Shai Shalev-Shwartz 的教科书推荐给你：</p>
<ul>
<li>Shai Ben-David 的机器学习介绍视频讲座，滑铁卢大学。地址：<a href="http://suo.im/1TFlK6" target="_blank" rel="external">http://suo.im/1TFlK6</a> </li>
<li>理解机器学习：从理论到算法，作者 Shai Ben-David &amp; Shai Shalev-Shwartz。地址：  <a href="http://suo.im/1NL0ix" target="_blank" rel="external">http://suo.im/1NL0ix</a> </li>
</ul>
<p>记住，这些介绍性资料并不需要全部看完才能开始我写的系列文章。视频讲座、教科书及其他资源可在以下情况查阅：当使用机器学习算法实现模型时或者当合适的概念被实际应用在后续步骤之中时。具体情况自己判断。</p>
<h3 id="第2步：更多的分类"><a href="#第2步：更多的分类" class="headerlink" title="第2步：更多的分类"></a>第2步：更多的分类</h3><p>我们从新材料开始，首先巩固一下我们的分类技术并引入一些额外的算法。虽然本篇文章的第一部分涵盖决策树、支持向量机、逻辑回归以及合成分类随机森林，我们还是会添加 k-最近邻、朴素贝叶斯分类器和多层感知器。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2127249-823e8e331044b63d.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>k-最近邻（kNN）是一个简单分类器和懒惰学习者的示例，其中所有计算都发生在分类时间上（而不是提前在训练步骤期间发生）。kNN 是非参数的，通过比较数据实例和 k 最近实例来决定如何分类。</p>
<ul>
<li>使用 Python 进行 k-最近邻分类。地址：  <a href="http://suo.im/2zqW0t" target="_blank" rel="external">http://suo.im/2zqW0t</a> </li>
</ul>
<p>朴素贝叶斯是基于贝叶斯定理的分类器。它假定特征之间存在独立性，并且一个类中任何特定特征的存在与任何其它特征在同一类中的存在无关。</p>
<ul>
<li>使用 Scikit-learn 进行文档分类，作者 Zac Stewart。地址：<a href="http://suo.im/2uwBm3" target="_blank" rel="external">http://suo.im/2uwBm3</a> </li>
</ul>
<p>多层感知器（MLP）是一个简单的前馈神经网络，由多层节点组成，其中每个层与随后的层完全连接。多层感知器在 Scikit-learn 版本 0.18 中作了介绍。</p>
<p>首先从 Scikit-learn 文档中阅读 MLP 分类器的概述，然后使用教程练习实现。</p>
<ul>
<li>神经网络模型（监督式），Scikit-learn 文档。地址：<a href="http://suo.im/3oR76l" target="_blank" rel="external">http://suo.im/3oR76l</a> </li>
<li>Python 和 Scikit-learn 的神经网络初学者指南 0.18！作者 Jose Portilla。地址：   <a href="http://suo.im/2tX6rG" target="_blank" rel="external">http://suo.im/2tX6rG</a> </li>
</ul>
<h3 id="第3步：更多聚类"><a href="#第3步：更多聚类" class="headerlink" title="第3步：更多聚类"></a>第3步：更多聚类</h3><p>我们现在接着讲聚类，一种无监督学习形式。上篇中，我们讨论了 k-means 算法; 我们在此介绍 DBSCAN 和期望最大化（EM）。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2127249-d153e4f5ca7e900e.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>首先，阅读这些介绍性文章; 第一个是 k 均值和 EM 聚类技术的快速比较，是对新聚类形式的一个很好的继续，第二个是对 Scikit-learn 中可用的聚类技术的概述：</p>
<ul>
<li>聚类技术比较：简明技术概述，作者 Matthew Mayo。地址： <a href="http://suo.im/4ctIvI" target="_blank" rel="external">http://suo.im/4ctIvI</a> </li>
<li>在玩具数据集中比较不同的聚类算法，Scikit-learn 文档。地址： <a href="http://suo.im/4uvbbM" target="_blank" rel="external">http://suo.im/4uvbbM</a> </li>
</ul>
<p>期望最大化（EM）是概率聚类算法，并因此涉及确定实例属于特定聚类的概率。EM 接近统计模型中参数的最大似然性或最大后验估计（Han、Kamber 和 Pei）。EM 过程从一组参数开始迭代直到相对于 k 聚类的聚类最大化。</p>
<p>首先阅读关于 EM 算法的教程。接下来，看看相关的 Scikit-learn 文档。最后，按照教程使用 Python 自己实现 EM 聚类。</p>
<ul>
<li>期望最大化（EM）算法教程，作者 Elena Sharova。地址：<a href="http://suo.im/33ukYd" target="_blank" rel="external">http://suo.im/33ukYd</a> </li>
<li>高斯混合模型，Scikit-learn 文档。地址：<a href="http://suo.im/20C2tZ" target="_blank" rel="external">http://suo.im/20C2tZ</a>  。</li>
<li>使用 Python 构建高斯混合模型的快速介绍，作者 Tiago Ramalho。地址：    <a href="http://suo.im/4oxFsj" target="_blank" rel="external">http://suo.im/4oxFsj</a> </li>
</ul>
<p>如果高斯混合模型初看起来令人困惑，那么来自 Scikit-learn 文档的这一相关部分应该可以减轻任何多余的担心：</p>
<blockquote>
<p>高斯混合对象实现期望最大化（EM）算法以拟合高斯模型混合。</p>
</blockquote>
<p>基于密度且具有噪声的空间聚类应用（DBSCAN）通过将密集数据点分组在一起，并将低密度数据点指定为异常值来进行操作。<br>首先从 Scikit-learn 的文档中阅读并遵循 DBSCAN 的示例实现，然后按照简明的教程学习：</p>
<ul>
<li>DBSCAN 聚类算法演示，Scikit-learn 文档。地址：<a href="http://suo.im/1l9tvX" target="_blank" rel="external">http://suo.im/1l9tvX</a> </li>
<li>基于密度的聚类算法（DBSCAN）和实现。地址：<a href="http://suo.im/1LEoXC" target="_blank" rel="external">http://suo.im/1LEoXC</a> </li>
</ul>
<h3 id="第4步：更多的集成方法"><a href="#第4步：更多的集成方法" class="headerlink" title="第4步：更多的集成方法"></a>第4步：更多的集成方法</h3><p>上篇只涉及一个单一的集成方法：随机森林（RF）。RF 作为一个顶级的分类器，在过去几年中取得了巨大的成功，但它肯定不是唯一的集成分类器。我们将看看包装、提升和投票。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2127249-3e3f0eae2ef7eb96.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>首先，阅读这些集成学习器的概述，第一个是通用性的；第二个是它们与 Scikit-learn 有关：</p>
<ul>
<li>集成学习器介绍，作者 Matthew Mayo  <a href="http://suo.im/cLESw" target="_blank" rel="external">http://suo.im/cLESw</a><br>Scikit-learn 中的集成方法，Scikit-learn 文档：<a href="http://suo.im/yFuY9" target="_blank" rel="external">http://suo.im/yFuY9</a> </li>
</ul>
<p>然后，在继续使用新的集成方法之前，请通过一个新的教程快速学习随机森林：</p>
<ul>
<li>Python 中的随机森林，来自 Yhat。地址： <a href="http://suo.im/2eujI" target="_blank" rel="external">http://suo.im/2eujI</a> </li>
</ul>
<p>包装、提升和投票都是不同形式的集成分类器，全部涉及建构多个模型; 然而，这些模型由什么算法构建，模型使用的数据，以及结果如何最终组合起来，这些都会随着方案而变化。</p>
<ul>
<li>包装：从同一分类算法构建多个模型，同时使用来自训练集的不同（独立）数据样本——Scikit-learn 实现包装分类器</li>
<li>提升：从同一分类算法构建多个模型，一个接一个地链接模型，以提高每个后续模型的学习——Scikit-learn 实现 AdaBoost</li>
<li>投票：构建来自不同分类算法的多个模型，并且使用标准来确定模型如何最好地组合——Scikit-learn 实现投票分类器</li>
</ul>
<p>那么，为什么要组合模型？为了从一个特定角度处理这个问题，这里是偏差-方差权衡的概述，具体涉及到提升，以下是 Scikit-learn 文档：</p>
<ul>
<li>单一评估器 vs 包装：偏差-方差分解，Scikit-learn 文档。地址： <a href="http://suo.im/3izlRB" target="_blank" rel="external">http://suo.im/3izlRB</a> </li>
</ul>
<p>现在你已经阅读了关于集成学习器的一些介绍性材料，并且对几个特定的集成分类器有了基本了解，下面介绍如何从 Machine Learning Mastery 中使用 Scikit-learn 在 Python 中实现集成分类器：</p>
<ul>
<li>使用 Scikit-learn 在 Python 中实现集成机器学习算法，作者 Jason Brownlee。地址：<a href="http://suo.im/9WEAr" target="_blank" rel="external">http://suo.im/9WEAr</a> </li>
</ul>
<h3 id="第5步：梯度提升"><a href="#第5步：梯度提升" class="headerlink" title="第5步：梯度提升"></a>第5步：梯度提升</h3><p>下一步我们继续学习集成分类器，探讨一个当代最流行的机器学习算法。梯度提升最近在机器学习中产生了显著的影响，成为了 Kaggle 竞赛中最受欢迎和成功的算法之一。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2127249-8803348bd2eeed47.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>首先，阅读梯度提升的概述：</p>
<ul>
<li>维基百科条目：梯度提升。地址：   <a href="http://suo.im/TslWi" target="_blank" rel="external">http://suo.im/TslWi</a> </li>
</ul>
<p>接下来，了解为什么梯度提升是 Kaggle 竞赛中「最制胜」的方法：</p>
<ul>
<li>为什么梯度提升完美解决了诸多 Kaggle 难题？Quora，地址：<a href="http://suo.im/3rS6ZO" target="_blank" rel="external">http://suo.im/3rS6ZO</a> </li>
<li>Kaggle 大师解释什么是梯度提升，作者 Ben Gorman。地址：<a href="http://suo.im/3nXlWR" target="_blank" rel="external">http://suo.im/3nXlWR</a> </li>
</ul>
<p>虽然 Scikit-learn 有自己的梯度提升实现，我们将稍作改变，使用 XGBoost 库，我们提到过这是一个更快的实现。</p>
<p>以下链接提供了 XGBoost 库的一些额外信息，以及梯度提升（出于必要）：</p>
<ul>
<li>维基百科条目：XGBoost。地址：   <a href="http://suo.im/2UlJ3V" target="_blank" rel="external">http://suo.im/2UlJ3V</a> </li>
<li>Ghub 上的 XGBoost 库。地址：   <a href="http://suo.im/2JeQI8" target="_blank" rel="external">http://suo.im/2JeQI8</a> </li>
<li>XGBoost 文档。地址：   <a href="http://suo.im/QRRrm" target="_blank" rel="external">http://suo.im/QRRrm</a> </li>
</ul>
<p>现在，按照这个教程把所有汇聚起来：</p>
<ul>
<li>Python 中 XGBoost 梯度提升树的实现指南，作者 Jesse Steinweg-Woods。地址：   <a href="http://suo.im/4FTqD5" target="_blank" rel="external">http://suo.im/4FTqD5</a> </li>
</ul>
<p>你还可以按照这些更简洁的示例进行强化：</p>
<ul>
<li>XGBoost 在 Kaggle 上的示例（Python）。地址：<a href="http://suo.im/4F9A1J" target="_blank" rel="external">http://suo.im/4F9A1J</a> </li>
<li>Iris 数据集和 XGBoost 简单教程，作者 Ieva Zarina。地址：<a href="http://suo.im/2Lyb1a" target="_blank" rel="external">http://suo.im/2Lyb1a</a> </li>
</ul>
<h3 id="第6步：更多的降维"><a href="#第6步：更多的降维" class="headerlink" title="第6步：更多的降维"></a>第6步：更多的降维</h3><p>降维是通过使用过程来获得一组主变量，将用于模型构建的变量从其初始数减少到一个减少数。</p>
<p>有两种主要形式的降维：</p>
<ul>
<li><ol>
<li>特征选择——选择相关特征的子集。地址：<a href="http://suo.im/4wlkrj" target="_blank" rel="external">http://suo.im/4wlkrj</a> </li>
</ol>
</li>
<li><ol>
<li>特征提取——构建一个信息性和非冗余的衍生值特征集。地址：  <a href="http://suo.im/3Gf0Yw" target="_blank" rel="external">http://suo.im/3Gf0Yw</a><br>下面是一对常用的特征提取方法。</li>
</ol>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2127249-39bada4e97632618.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>主成分分析（PCA）是一种统计步骤，它使用正交变换将可能相关变量的一组观测值转换为一组称为主成分的线性不相关变量值。主成分的数量小于或等于原始变量的数量。这种变换以这样的方式定义，即第一主成分具有最大可能的方差（即考虑数据中尽可能多的变率）</p>
</blockquote>
<p>以上定义来自 PCA 维基百科条目，如果感兴趣可进一步阅读。但是，下面的概述/教程非常彻底：</p>
<ul>
<li>主成分分析：3 个简单的步骤，作者 Sebastian Raschka。地址： <a href="http://suo.im/1ahFdW" target="_blank" rel="external">http://suo.im/1ahFdW</a> </li>
</ul>
<blockquote>
<p>线性判别分析（LDA）是 Fisher 线性判别的泛化，是统计学、模式识别和机器学习中使用的一种方法，用于发现线性组合特征或分离两个或多个类别的对象或事件的特征。所得到的组合可以用作线性分类器，或者更常见地，用作后续分类之前的降维。</p>
</blockquote>
<p>LDA 与方差分析（ANOVA）和回归分析密切相关，它同样尝试将一个因变量表示为其他特征或测量的线性组合。然而，ANOVA 使用分类独立变量和连续因变量，而判别分析具有连续的独立变量和分类依赖变量（即类标签）。</p>
<p>上面的定义也来自维基百科。下面是完整的阅读：</p>
<ul>
<li>线性判别分析——直至比特，作者 Sebastian Raschka。地址：  <a href="http://suo.im/gyDOb" target="_blank" rel="external">http://suo.im/gyDOb</a> </li>
</ul>
<p>你对 PCA 和 LDA 对于降维的实际差异是否感到困惑？Sebastian Raschka 做了如下澄清：</p>
<blockquote>
<p>线性判别分析（LDA）和主成分分析（PCA）都是通常用于降维的线性转换技术。PCA 可以被描述为「无监督」算法，因为它「忽略」类标签，并且其目标是找到使数据集中的方差最大化的方向（所谓的主成分）。与 PCA 相反，LDA 是「监督的」并且计算表示使多个类之间的间隔最大化的轴的方向（「线性判别式」）。</p>
</blockquote>
<p>有关这方面的简要说明，请阅读以下内容：</p>
<ul>
<li>LDA 和 PCA 之间的降维有什么区别？作者 Sebastian Raschka。地址：  <a href="http://suo.im/2IPt0U" target="_blank" rel="external">http://suo.im/2IPt0U</a> </li>
</ul>
<h3 id="第-7-步：更多的深度学习"><a href="#第-7-步：更多的深度学习" class="headerlink" title="第 7 步：更多的深度学习"></a>第 7 步：更多的深度学习</h3><p>上篇中提供了一个学习神经网络和深度学习的入口。如果你的学习到目前比较顺利并希望巩固对神经网络的理解，并练习实现几个常见的神经网络模型，那么请继续往下看。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2127249-64d40cd8e9ce69b6.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>首先，看一些深度学习基础材料：</p>
<ul>
<li>深度学习关键术语及解释，作者 Matthew Mayo</li>
<li>理解深度学习的 7 个步骤，作者 Matthew Mayo。地址：<a href="http://suo.im/3QmEfV" target="_blank" rel="external">http://suo.im/3QmEfV</a> </li>
</ul>
<p>接下来，在 Google 的机器智能开源软件库 TensorFlow（一个有效的深度学习框架和现今几乎是最好的神经网络工具）尝试一些简明的概述／教程：</p>
<ul>
<li>机器学习敲门砖：任何人都能看懂的 TensorFlow 介绍（第 1、2 部分）</li>
<li>入门级解读：小白也能看懂的 TensorFlow 介绍（第 3、4 部分）</li>
</ul>
<p>最后，直接从 TensorFlow 网站试用这些教程，它实现了一些最流行和常见的神经网络模型：</p>
<ul>
<li>循环神经网络，谷歌 TensorFlow 教程。地址： <a href="http://suo.im/2gtkze" target="_blank" rel="external">http://suo.im/2gtkze</a> </li>
<li>卷积神经网络，谷歌 TensorFlow 教程。地址： <a href="http://suo.im/g8Lbg" target="_blank" rel="external">http://suo.im/g8Lbg</a> </li>
</ul>
<p>此外，目前一篇关于 7 个步骤掌握深度学习的文章正在写作之中，重点介绍使用位于 TensorFlow 顶部的高级 API，以增模型实现的容易性和灵活性。我也将在完成后在这儿添加一个链接。</p>
<p>相关的：</p>
<p>进入机器学习行业之前应该阅读的 5 本电子书。  <a href="http://suo.im/SlZKt" target="_blank" rel="external">http://suo.im/SlZKt</a><br>理解深度学习的 7 个步骤。  <a href="http://suo.im/3QmEfV" target="_blank" rel="external">http://suo.im/3QmEfV</a><br>机器学习关键术语及解释。  <a href="http://suo.im/2URQGm" target="_blank" rel="external">http://suo.im/2URQGm</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/10/模型融合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="McGrady">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/haizei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="McGrady">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/10/模型融合/" itemprop="url">模型融合</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-10T14:26:02+08:00">
                2017-04-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/机器学习/" itemprop="url" rel="index">
                    <span itemprop="name">机器学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="模型融合"><a href="#模型融合" class="headerlink" title="模型融合"></a>模型融合</h1><h2 id="1-blending"><a href="#1-blending" class="headerlink" title="1.blending"></a>1.blending</h2><p>&emsp;&emsp; 比如数据分成train和test，对于model_i（比如xgboost） ，即对所有的数据训练模型model_i，预测test数据生成预测向量v_i， 然后对train做CV fold=5，然后对其他4份做训练数据，另外一份作为val数据，得出模型model_i_j，然后对val预测生成向量t_i_j， 然后将5分向量concat生成t_i，这是对应t_i与v_i对应，每个模型都能生成这样一组向量，然后在顶层的模型比如LR或者线性对t向量进行训练，生成blender模型对v向量进行预测<br>&emsp;&emsp; 也就是需要生成如下的一个表，训练集数据为把数据切分交叉生成，测试集为训练数据全部训练对测试集预测生成</p>
<table>
<thead>
<tr>
<th>id</th>
<th>model_1</th>
<th>model_2</th>
<th>model_3</th>
<th>model_4</th>
<th>label</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0.1</td>
<td>0.2</td>
<td>0.14</td>
<td>0.15</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>0.2</td>
<td>0.22</td>
<td>0.18</td>
<td>0.3</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>0.8</td>
<td>0.7</td>
<td>0.88</td>
<td>0.6</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>0.3</td>
<td>0.3</td>
<td>0.2</td>
<td>0.22</td>
<td>0</td>
</tr>
<tr>
<td>5</td>
<td>0.5</td>
<td>0.3</td>
<td>0.6</td>
<td>0.5</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>blending 的优点是：比stacking简单，不会造成数据穿越，generalizers和stackers使用不同的数据，可以随时添加其他模型到blender中。</p>
<p>与stacking的区别是：<br> stacking在预测 测试集上时直接基于训练数据的<br> blender在预测 测试集上每次cv的子集都会预测下预测集， n次cv取平均</p>
<p><img src="media/14918055623388/14918064349355.jpg" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> load_data</div><div class="line"><span class="keyword">from</span> sklearn.cross_validation <span class="keyword">import</span> StratifiedKFold</div><div class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier, ExtraTreesClassifier, GradientBoostingClassifier</div><div class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</div><div class="line"><span class="keyword">from</span> utility <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> evaluator <span class="keyword">import</span> *</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">logloss</span><span class="params">(attempt, actual, epsilon=<span class="number">1.0e-15</span>)</span>:</span></div><div class="line">    <span class="string">"""Logloss, i.e. the score of the bioresponse competition.</span></div><div class="line">    """</div><div class="line">    attempt = np.clip(attempt, epsilon, <span class="number">1.0</span>-epsilon)</div><div class="line">    <span class="keyword">return</span> - np.mean(actual * np.log(attempt) + (<span class="number">1.0</span> - actual) * np.log(<span class="number">1.0</span> - attempt))</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line"></div><div class="line">    np.random.seed(<span class="number">0</span>) <span class="comment"># seed to shuffle the train set</span></div><div class="line"></div><div class="line">    <span class="comment"># n_folds = 10</span></div><div class="line">    n_folds = <span class="number">5</span></div><div class="line">    verbose = <span class="keyword">True</span></div><div class="line">    shuffle = <span class="keyword">False</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment"># X, y, X_submission = load_data.load()</span></div><div class="line"></div><div class="line">    train_x_id, train_x, train_y = preprocess_train_input()</div><div class="line">    val_x_id, val_x, val_y = preprocess_val_input()</div><div class="line"></div><div class="line">    X = train_x</div><div class="line">    y = train_y</div><div class="line">    X_submission = val_x</div><div class="line">    X_submission_y = val_y</div><div class="line"></div><div class="line">    <span class="keyword">if</span> shuffle:</div><div class="line">        idx = np.random.permutation(y.size)</div><div class="line">        X = X[idx]</div><div class="line">        y = y[idx]</div><div class="line"></div><div class="line"></div><div class="line">    skf = list(StratifiedKFold(y, n_folds))</div><div class="line"></div><div class="line">    clfs = [RandomForestClassifier(n_estimators=<span class="number">100</span>, n_jobs=<span class="number">-1</span>, criterion=<span class="string">'gini'</span>),</div><div class="line">            RandomForestClassifier(n_estimators=<span class="number">100</span>, n_jobs=<span class="number">-1</span>, criterion=<span class="string">'entropy'</span>),</div><div class="line">            ExtraTreesClassifier(n_estimators=<span class="number">100</span>, n_jobs=<span class="number">-1</span>, criterion=<span class="string">'gini'</span>),</div><div class="line">            ExtraTreesClassifier(n_estimators=<span class="number">100</span>, n_jobs=<span class="number">-1</span>, criterion=<span class="string">'entropy'</span>),</div><div class="line">            GradientBoostingClassifier(learning_rate=<span class="number">0.05</span>, subsample=<span class="number">0.5</span>, max_depth=<span class="number">6</span>, n_estimators=<span class="number">50</span>)]</div><div class="line"></div><div class="line">    <span class="keyword">print</span> <span class="string">"Creating train and test sets for blending."</span></div><div class="line">    </div><div class="line">    dataset_blend_train = np.zeros((X.shape[<span class="number">0</span>], len(clfs)))</div><div class="line">    dataset_blend_test = np.zeros((X_submission.shape[<span class="number">0</span>], len(clfs)))</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> j, clf <span class="keyword">in</span> enumerate(clfs):</div><div class="line">        <span class="keyword">print</span> j, clf</div><div class="line">        dataset_blend_test_j = np.zeros((X_submission.shape[<span class="number">0</span>], len(skf)))</div><div class="line">        <span class="keyword">for</span> i, (train, test) <span class="keyword">in</span> enumerate(skf):</div><div class="line">            <span class="keyword">print</span> <span class="string">"Fold"</span>, i</div><div class="line">            X_train = X[train]</div><div class="line">            y_train = y[train]</div><div class="line">            X_test = X[test]</div><div class="line">            y_test = y[test]</div><div class="line">            clf.fit(X_train, y_train)</div><div class="line">            y_submission = clf.predict_proba(X_test)[:,<span class="number">1</span>]</div><div class="line">            dataset_blend_train[test, j] = y_submission</div><div class="line">            dataset_blend_test_j[:, i] = clf.predict_proba(X_submission)[:,<span class="number">1</span>]</div><div class="line">        dataset_blend_test[:,j] = dataset_blend_test_j.mean(<span class="number">1</span>)</div><div class="line">        print(<span class="string">"val auc Score: %0.5f"</span> % (evaluate2(dataset_blend_test[:,j], X_submission_y)))</div><div class="line"></div><div class="line">    <span class="keyword">print</span></div><div class="line">    <span class="keyword">print</span> <span class="string">"Blending."</span></div><div class="line">    <span class="comment"># clf = LogisticRegression()</span></div><div class="line">    clf = GradientBoostingClassifier(learning_rate=<span class="number">0.02</span>, subsample=<span class="number">0.5</span>, max_depth=<span class="number">6</span>, n_estimators=<span class="number">100</span>)</div><div class="line">    clf.fit(dataset_blend_train, y)</div><div class="line">    y_submission = clf.predict_proba(dataset_blend_test)[:,<span class="number">1</span>]</div><div class="line"></div><div class="line">    <span class="keyword">print</span> <span class="string">"Linear stretch of predictions to [0,1]"</span></div><div class="line">    y_submission = (y_submission - y_submission.min()) / (y_submission.max() - y_submission.min())</div><div class="line">    <span class="keyword">print</span> <span class="string">"blend result"</span></div><div class="line">    print(<span class="string">"val auc Score: %0.5f"</span> % (evaluate2(y_submission, X_submission_y)))</div><div class="line">    <span class="keyword">print</span> <span class="string">"Saving Results."</span></div><div class="line">    np.savetxt(fname=<span class="string">'blend_result.csv'</span>, X=y_submission, fmt=<span class="string">'%0.9f'</span>)</div></pre></td></tr></table></figure>
<p>##2.rank_avg<br>这种融合方法适合排序评估指标，比如auc之类的<br><img src="media/14918055623388/14918065471980.jpg" alt=""><br>其中weight_i为该模型权重，权重为1表示平均融合<br>rank_i表示样本的升序排名 ，也就是越靠前的样本融合后也越靠前<br>能较快的利用排名融合多个模型之间的差异，而不用去加权样本的概率值融合</p>
<p>##3.weighted<br>加权融合，给模型一个权重weight，然后加权得到最终结果<br>weight为1时为均值融合，result_i为模型i的输出<br><img src="media/14918055623388/14918065640926.jpg" alt=""></p>
<p>##4.bagging<br>从特征，参数，样本的多样性差异性来做多模型融合，参考随机森林<br><img src="media/14918055623388/14918065784039.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/05/数据库工具类/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="McGrady">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/haizei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="McGrady">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/05/数据库工具类/" itemprop="url">数据库工具类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-05T21:20:34+08:00">
                2017-01-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数据库工具类"><a href="#数据库工具类" class="headerlink" title="数据库工具类"></a>数据库工具类</h1><p>JDBC原理，解析.Properties型配置文件的包等</p>
<h2 id="数据库连接类"><a href="#数据库连接类" class="headerlink" title="数据库连接类"></a>数据库连接类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> DBHandler;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.sql.Connection;</div><div class="line"><span class="keyword">import</span> java.sql.DriverManager;</div><div class="line"><span class="keyword">import</span> java.sql.SQLException;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBConnection</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String driver = <span class="string">"com.mysql.jdbc.Driver"</span>;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> String conUrl = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(String ip, String port, String database, String user, String password)</span> </span>&#123;</div><div class="line">		conUrl = <span class="string">"jdbc:mysql://"</span> + ip + <span class="string">":"</span> + port + <span class="string">"/"</span> + database + <span class="string">"?useUnicode=true&amp;characterEncoding=utf8"</span>;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			Class.forName(driver);</div><div class="line">			System.out.println(<span class="keyword">new</span> Date()+<span class="string">" Using conn url: "</span> + conUrl);</div><div class="line">			Connection conn = DriverManager.getConnection(conUrl,user,password);</div><div class="line">			<span class="keyword">return</span> conn;</div><div class="line">		&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="数据库操作类"><a href="#数据库操作类" class="headerlink" title="数据库操作类"></a>数据库操作类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> DBHandler;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.BufferedInputStream;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.FileInputStream;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.sql.Connection;</div><div class="line"><span class="keyword">import</span> java.sql.ResultSet;</div><div class="line"><span class="keyword">import</span> java.sql.SQLException;</div><div class="line"><span class="keyword">import</span> java.sql.Statement;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Properties;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperationDB</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> Connection conn = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">private</span> Statement statement = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">private</span> String DB_addrss = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">private</span> String DB_database = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">private</span> String DB_port = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">private</span> String DB_user = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">private</span> String DB_password = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Connection <span class="title">getConn</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> conn;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConn</span><span class="params">(Connection conn)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.conn = conn;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Statement <span class="title">getStatement</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> statement;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatement</span><span class="params">(Statement statement)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.statement = statement;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDB_addrss</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> DB_addrss;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDB_addrss</span><span class="params">(String dB_addrss)</span> </span>&#123;</div><div class="line">		DB_addrss = dB_addrss;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDB_database</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> DB_database;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDB_database</span><span class="params">(String dB_database)</span> </span>&#123;</div><div class="line">		DB_database = dB_database;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDB_port</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> DB_port;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDB_port</span><span class="params">(String dB_port)</span> </span>&#123;</div><div class="line">		DB_port = dB_port;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDB_user</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> DB_user;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDB_user</span><span class="params">(String dB_user)</span> </span>&#123;</div><div class="line">		DB_user = dB_user;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDB_password</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> DB_password;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDB_password</span><span class="params">(String dB_password)</span> </span>&#123;</div><div class="line">		DB_password = dB_password;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">OperationDB</span><span class="params">()</span> </span>&#123;</div><div class="line">		String configPath = <span class="string">"./configure/91_ent_domain.properties"</span>;</div><div class="line">		initConfigure(configPath);</div><div class="line">		connect();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">OperationDB</span><span class="params">(String configPath)</span> </span>&#123;</div><div class="line">		initConfigure(configPath);</div><div class="line">		connect();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">connect</span><span class="params">()</span> </span>&#123;</div><div class="line">		conn = DBConnection.getConnection(DB_addrss, DB_port, DB_database, DB_user, DB_password);</div><div class="line">		<span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				statement = conn.createStatement();</div><div class="line">				<span class="keyword">if</span> (statement != <span class="keyword">null</span>) &#123;</div><div class="line">					System.out.println(<span class="string">"sucess"</span>);</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					System.out.println(<span class="string">"error"</span>);</div><div class="line">				&#125;</div><div class="line">			&#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">				e.printStackTrace();</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			System.out.println(<span class="string">"error"</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initConfigure</span><span class="params">(String configPath)</span> </span>&#123;</div><div class="line">		Properties pro = <span class="keyword">new</span> Properties();</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			pro.load(<span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> FileInputStream(configPath)));</div><div class="line">			DB_addrss = pro.getProperty(<span class="string">"DB_addrss"</span>);</div><div class="line">			DB_database = pro.getProperty(<span class="string">"DB_database"</span>);</div><div class="line">			DB_port = pro.getProperty(<span class="string">"DB_port"</span>);</div><div class="line">			DB_user = pro.getProperty(<span class="string">"DB_user"</span>);</div><div class="line">			DB_password = pro.getProperty(<span class="string">"DB_password"</span>);</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> ResultSet <span class="title">executeSelect</span><span class="params">(String sql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">		ResultSet executeQuery = statement.executeQuery(sql);</div><div class="line">		<span class="keyword">return</span> executeQuery;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">executeUpdate</span><span class="params">(String sql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">		<span class="keyword">int</span> executeUpdate = statement.executeUpdate(sql);</div><div class="line">		<span class="keyword">return</span> executeUpdate;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			System.out.println(<span class="string">"数据库关闭"</span>);</div><div class="line">			conn.close();</div><div class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">    <span class="comment">//操作例子</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, SQLException </span>&#123;</div><div class="line">		OperationDB db = <span class="keyword">new</span> OperationDB(<span class="string">"./configure/91_ent_domain.properties"</span>);<span class="comment">//读取数据库配置文件</span></div><div class="line">		List&lt;String&gt; readLines = FileUtils.readLines(<span class="keyword">new</span> File(<span class="string">"C:\\Users\\DELL\\Desktop\\a.txt"</span>));</div><div class="line">		String sql = <span class="string">""</span>;</div><div class="line">		<span class="keyword">for</span> (String s : readLines) &#123;</div><div class="line">			sql = <span class="string">"SELECT id,name FROM `basic_organization_info` WHERE `name` LIKE '"</span> + s + <span class="string">"'"</span>;</div><div class="line">			ResultSet res = db.executeSelect(sql);</div><div class="line">			<span class="keyword">while</span> (res.next()) &#123;</div><div class="line">				<span class="keyword">int</span> id = res.getInt(<span class="number">1</span>);</div><div class="line">				String name = res.getString(<span class="number">2</span>);</div><div class="line">				System.out.println(id + <span class="string">"\t"</span> + name);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		db.close();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="properties内容"><a href="#properties内容" class="headerlink" title="**.properties内容"></a>**.properties内容</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#地址</div><div class="line">DB_addrss=192.168.0.0</div><div class="line">#库名</div><div class="line">DB_database=xxxx</div><div class="line">#端口</div><div class="line">DB_port=xx</div><div class="line">#用户名</div><div class="line">DB_user=xx</div><div class="line">#密码</div><div class="line">DB_password=xxxxxx</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/haizei.jpg"
                alt="McGrady" />
            
              <p class="site-author-name" itemprop="name">McGrady</p>
              <p class="site-description motion-element" itemprop="description">Second place means you're the first loser.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/TracyMcgrady6" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-globe"></i>GitHub</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">McGrady</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
